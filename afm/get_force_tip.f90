subroutine get_force_tip(n, x0, f, f2)
	use kinds     , only: DP
	use module_afm, only: k_F
	use math      , only: v3_cross, v3_normlize
	use param     , only: au2a
	implicit none
	!--------------------------------------------------------------------
	integer     , intent( in) :: n
	real(DP)    , intent( in) :: x0(3,n)
	real(DP)    , intent(out) :: f (3,n)
	real(DP)    , intent(out) :: f2(3,n)
	!--------------------------------------------------------------------
	integer                   :: j
	real(DP)                  :: xz(3), dx(3), fr, fr1, fr2, x(3,n)
	real(DP)                  :: dx1(3), dx2(3), dx3(3), dx4(3), dx5(3)
	real(DP)                  :: ff1(3), ff2(3), ff3(3)
	real(DP)                  :: PI, a, c
	real(DP)                  :: b_Cu_C
	real(DP)                  :: b_C_O
	real(DP)                  :: b_Cu_O
	real(DP)                  :: a_Cu_Cu_C
	real(DP)                  :: a_Cu_Cu_C_90
	real(DP)                  :: a_Cu_C_O
	real(DP)                  :: a_Cu_C_O_90
	real(DP)                  :: a_Cu_Cu_O
	real(DP)                  :: bc, eps
	!--------------------------------------------------------------------
	PI  = acos(-1.0_DP)
	a   = 180.0_DP / PI
	eps = 1.0D-2
	x   = x0
	bc  = 0.4_DP
	!--------------------------------------------------------------------
	f  = 0.0_DP
	f2 = 0.0_DP
	xz = x(:,4)
	call get_b(x(:,4), x(:,5), b_Cu_C)
	call get_b(x(:,5), x(:,6), b_C_O )
	call get_b(x(:,4), x(:,6), b_Cu_O)
	!--------------------------------------------------------------------
	xz(3) = xz(3) + b_Cu_C
	!--------------------------------------------------------------------
	call get_a(xz    , x(:,4), x(:,5), a_Cu_Cu_C )
	call get_a(xz    , x(:,4), x(:,6), a_Cu_Cu_O )
	call get_a(x(:,4), x(:,5), x(:,6), a_Cu_C_O  )
	!--------------------------------------------------------------------
	a_Cu_Cu_C_90 = a_Cu_Cu_C - 90.0_DP
	a_Cu_C_O_90  = a_Cu_C_O  - 90.0_DP
	!--------------------------------------------------------------------
	! bond Cu-C
	!
	dx = (x(:,5) - x(:,4)) / b_Cu_C
	!--------------------------------------------------------------------
	fr = 0.0_DP
	do j=1, 9
		fr = fr + k_F(j,1) * b_Cu_C**(j-1)
	end do
	!--------------------------------------------------------------------
	ff1 = dx * fr
	ff2 = - ff1
	f(:,5) = f(:,5) + ff1
	f(:,4) = f(:,4) + ff2
	!f(:,6) = f(:,6) + dx * fr
	f2(:,6) = f2(:,6) + dx * fr
	!--------------------------------------------------------------------
	! bond C-O
	!
	dx = (x(:,6) - x(:,5)) / b_C_O
	!--------------------------------------------------------------------
	fr = 0.0_DP
	do j=1, 9
		fr = fr + k_F(j,2) * b_C_O**(j-1)
	end do
	!--------------------------------------------------------------------
	ff1 = - dx * fr
	ff2 = - ff1
	f(:,5) = f(:,5) + ff1
	f(:,6) = f(:,6) + ff2
	!f2(:,6) = f2(:,6) + dx * fr
	!--------------------------------------------------------------------
	! angle Cu-Cu-C
	!
	if (abs(abs(a_Cu_Cu_C)-180.0_DP) > eps) then
		!-----------------------------------------------------------------
		c = (a_Cu_Cu_C-90.0_DP) / a
		fr = 0.0_DP
		do j=1, 9
			fr = fr + k_F(j,3) * c**(j-1)
		end do
		fr1 = fr / b_Cu_C
		fr2 = fr / b_Cu_O
		!-----------------------------------------------------------------
		dx1 = (xz     - x(:,4))
		dx2 = (x(:,5) - x(:,4))
		dx3 = v3_cross(dx1, dx2)
		dx4 = v3_cross(dx3, dx2)
		dx4 = v3_normlize(dx4)
		ff3 = dx4 * fr1
		f(:,5) = f(:,5) + ff3
		!f2(:,5) = f2(:,5) + ff3
		!-----------------------------------------------------------------
		dx2 = (x(:,6) - x(:,4))
		dx4 = v3_cross(dx3, dx2)
		dx4 = v3_normlize(dx4)
		ff2 = dx4 * fr2
		ff1 = - ff3 - ff2
		!f(:,6) = f(:,6) + ff2
		f(:,4) = f(:,4) - ff3
		f2(:,6) = f2(:,6) + ff2
		!-----------------------------------------------------------------
	end if
	!--------------------------------------------------------------------
	! angle Cu-C-O
	!
	if (abs(abs(a_Cu_C_O)-180.0_DP) > eps) then
		!-----------------------------------------------------------------
		c = (a_Cu_C_O-90.0_DP) / a
		fr = 0.0_DP
		do j=1, 9
			fr = fr + k_F(j,4) * c**(j-1)
		end do
		fr1 = fr / b_Cu_C
		fr2 = fr / b_C_O
		!-----------------------------------------------------------------
		dx1 = (x(:,4) - x(:,5))
		dx2 = (x(:,6) - x(:,5))
		dx3 = v3_cross(dx1, dx2)
		dx4 = v3_cross(dx3, dx2)
		dx4 = v3_normlize(dx4)
		!-----------------------------------------------------------------
		dx5 = v3_cross(dx1, dx3)
		dx5 = v3_normlize(dx5)
		!-----------------------------------------------------------------
		ff2 = dx4 * fr2
		ff1 = dx5 * fr1
		ff3 = - ff1 - ff2
		!-----------------------------------------------------------------
		f(:,5) = f(:,5) + ff3
		f(:,6) = f(:,6) + ff2
		f(:,4) = f(:,4) + ff1
		!f2(:,5) = f2(:,5) + ff3
		!f2(:,6) = f2(:,6) + ff2
		!-----------------------------------------------------------------
	end if
	!--------------------------------------------------------------------
end subroutine
